<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Remisión - UIB</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='main_layout.css') }}">
    <style>
        .form-control[readonly], .form-select[disabled] { 
            background-color: #e9ecef; 
            opacity: 1; 
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        .card-header h5 { color: var(--primary-dark); }
        .highlight-card { border-color: var(--primary-color); }
    </style>
</head>
<body>

<div class="main-container">
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <a href="{{ url_for('index') }}">
                <img src="{{ url_for('static', filename='UIBH_logo_WHITE2-300x78-1.png') }}" alt="UIB Logo">
            </a>
        </div>
        <ul class="nav flex-column">
            <li class="nav-item"><a class="nav-link" href="{{ url_for('formulario_remision') }}"><i class="fas fa-file-alt fa-fw"></i> Radicar Remisión</a></li>
            <li class="nav-item"><a class="nav-link active" href="{{ url_for('control') }}"><i class="fas fa-cogs fa-fw"></i> Control de remisiones </a></li>
            <li class="nav-item"><a class="nav-link" href="{{ url_for('panel_cobros') }}"><i class="fas fa-hand-holding-usd fa-fw"></i> Control de Cobros</a></li>
            <li class="nav-item"><a class="nav-link" href="{{ url_for('visualizar_cartera') }}"><i class="fas fa-book fa-fw"></i> Cartera</a></li>
            <li class="nav-item"><a class="nav-link" href="{{ url_for('visualizar_vencimientos') }}"><i class="fas fa-calendar-times fa-fw"></i> Control de Vencimientos</a></li>
            <li class="nav-item"><a class="nav-link" href="{{ url_for('prospectos_vista') }}"><i class="fas fa-users fa-fw"></i> Control de Prospectos</a></li>
            <li class="nav-item"><a class="nav-link" href="{{ url_for('siniestros_registrar') }}"><i class="fas fa-car-crash fa-fw"></i> Siniestros</a></li>
            <li class="nav-item"><a class="nav-link" href="{{ url_for('recaudo') }}"><i class="fas fa-chart-line fa-fw"></i> Produccion</a></li>
            <li class="nav-item"><a class="nav-link" href="{{ url_for('visualizar_sarlaft') }}"><i class="fas fa-user-shield fa-fw"></i> Documentos - SARLAFT</a></li>
            <li class="nav-item"><a class="nav-link" href="{{ url_for('mostrar_formulario_crear_carpeta') }}"><i class="fas fa-folder-plus fa-fw"></i> Espacio Cliente - Vendedor</a></li>
            <li class="nav-item"><a class="nav-link" href="{{ url_for('mostrar_formulario_carga_maestra') }}"><i class="fas fa-upload fa-fw"></i> Carga Maestra</a></li>
            <li class="nav-item mt-auto"><a class="nav-link" href="{{ url_for('admin.dashboard') }}"><i class="fas fa-tachometer-alt fa-fw"></i> Admin</a></li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="content">
        <header class="pb-3 mb-4 border-bottom d-flex justify-content-between align-items-center">
            <div>
                <h1 class="h3"><i class="fas fa-edit me-2"></i>Editar Remisión</h1>
                <p class="text-muted">Consecutivo: <strong>{{ datos.consecutivo | default('N/A', true) }}</strong></p>
            </div>
            <div class="text-end">
                <a href="{{ url_for('control') }}" class="btn btn-secondary"><i class="fas fa-arrow-left me-2"></i> Volver a Control</a>
            </div>
        </header>

        <form method="POST" action="{{ url_for('guardar_numero_remision') }}" id="mainForm" class="card p-4">
            <input type="hidden" name="consecutivo" value="{{ datos.consecutivo | default('', true) }}">

            <!-- Número de Remisión Manual -->
            <div class="card shadow-sm mb-4 highlight-card">
                <div class="card-header"><h5 class="mb-0"><i class="fas fa-file-signature me-2"></i>Número de Remisión</h5></div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <label for="numero_remision_manual" class="form-label">Número Remisión</label>
                            <input type="text" class="form-control" name="numero_remision_manual" id="numero_remision_manual" value="{{ datos.numero_remision_manual | default('', true) }}" placeholder="Ingrese el número de remisión">
                            <div class="form-text">Este es el único campo que se puede modificar.</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Datos Básicos -->
            <fieldset class="mb-4">
                <div class="card shadow-sm mb-4">
                    <div class="card-header"><h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Datos de la Remisión</h5></div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="row mb-3">
                                <div class="col-auto"><div class="form-check"><input class="form-check-input" type="checkbox" name="renovacion" id="renovacion" value="si" {% if datos.renovacion == 'si' %}checked{% endif %} disabled><label class="form-check-label" for="renovacion"><i class="fas fa-redo"></i> Es Renovación</label></div></div>
                                <div class="col-auto"><div class="form-check"><input class="form-check-input" type="checkbox" name="negocio_nuevo" id="negocio_nuevo" value="si" {% if datos.negocio_nuevo == 'si' %}checked{% endif %} disabled><label class="form-check-label" for="negocio_nuevo"><i class="fas fa-plus-circle"></i> Es Negocio Nuevo</label></div></div>
                                <div class="col-auto"><div class="form-check"><input class="form-check-input" type="checkbox" name="renovable" id="renovable" value="si" {% if datos.renovable == 'si' %}checked{% endif %} disabled><label class="form-check-label" for="renovable"><i class="fas fa-sync"></i> Es Renovable</label></div></div>
                                <div class="col-auto"><div class="form-check"><input class="form-check-input" type="checkbox" name="modificacion" id="modificacion" value="si" {% if datos.modificacion == 'si' %}checked{% endif %} disabled><label class="form-check-label" for="modificacion"><i class="fas fa-edit"></i> Es Modificación</label></div></div>
                                <div class="col-auto"><div class="form-check"><input class="form-check-input" type="checkbox" name="anexo_checkbox" id="anexo_checkbox" value="si" {% if datos.anexo_checkbox == 'si' %}checked{% endif %} disabled><label class="form-check-label" for="anexo_checkbox"><i class="fas fa-paperclip"></i> Es Anexo</label></div></div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-4 mb-3"><label for="fecha_recepcion" class="form-label">Fecha de Recepción</label><input type="date" name="fecha_recepcion" id="fecha_recepcion" class="form-control" value="{{ datos.fecha_recepcion | default('', true) }}" readonly></div>
                                <div class="col-md-4 mb-3"><label for="tomador" class="form-label">Tomador</label><input type="text" name="tomador" id="tomador" class="form-control" value="{{ datos.tomador | default('', true) }}" readonly></div>
                                <div class="col-md-4 mb-3"><label for="nit" class="form-label">NIT / CC</label><input type="text" name="nit" id="nit" class="form-control" value="{{ datos.nit | default('', true) }}" readonly></div>
                            </div>
                            <div class="row">
                                <div class="col-md-3 mb-3"><label for="aseguradora" class="form-label">Aseguradora</label><select name="aseguradora" id="aseguradora" class="form-select" disabled><option value="">Seleccione...</option>{% for opt in opciones_aseguradora %}<option value="{{ opt }}" {% if opt == datos.aseguradora %}selected{% endif %}>{{ opt }}</option>{% endfor %}</select></div>
                                <div class="col-md-3 mb-3"><label for="ramo" class="form-label">Ramo</label><select name="ramo" id="ramo" class="form-select" disabled><option value="">Seleccione...</option>{% for opt in opciones_ramo %}<option value="{{ opt }}" {% if opt == datos.ramo %}selected{% endif %}>{{ opt }}</option>{% endfor %}</select></div>
                                <div class="col-md-3 mb-3"><label for="poliza" class="form-label">N° Póliza</label><input type="text" name="poliza" id="poliza" class="form-control" value="{{ datos.poliza | default('', true) }}" readonly></div>
                                <div class="col-md-3 mb-3"><label for="anexo" class="form-label">Anexo / Certificado</label><input type="text" name="anexo" id="anexo" class="form-control" value="{{ datos.anexo | default('', true) }}" readonly></div>
                            </div>
                            <div class="row">
                                <div class="col-md-4 mb-3"><label for="fecha_inicio" class="form-label">Fecha Inicio Vigencia</label><input type="date" name="fecha_inicio" id="fecha_inicio" class="form-control" value="{{ datos.fecha_inicio | default('', true) }}" readonly></div>
                                <div class="col-md-4 mb-3"><label for="fecha_fin" class="form-label">Fecha Fin Vigencia</label><input type="date" name="fecha_fin" id="fecha_fin" class="form-control" value="{{ datos.fecha_fin | default('', true) }}" readonly></div>
                                <div class="col-md-4 mb-3"><label for="fecha_limite_pago" class="form-label">Fecha Límite de Pago</label><input type="date" name="fecha_limite_pago" id="fecha_limite_pago" class="form-control" value="{{ datos.fecha_limite_pago | default('', true) }}" readonly></div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3"><label for="analista_responsable" class="form-label">Analista Responsable</label><select name="analista_responsable" id="analista_responsable" class="form-select" disabled><option value="">Seleccione...</option>{% for opt in opciones_analista %}<option value="{{ opt }}" {% if opt == datos.analista_responsable %}selected{% endif %}>{{ opt }}</option>{% endfor %}</select></div>
                            </div>
                        </div>
                    </div>
                </div>
            </fieldset>

            <fieldset class="mb-4">
                <div class="card shadow-sm mb-4">
                    <div class="card-header"><h5 class="mb-0"><i class="fas fa-credit-card"></i> Información de Venta y Comisiones</h5></div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="row">
                                <div class="col-md-4 mb-3"><label for="tipo_moneda" class="form-label">Tipo Moneda</label><select name="tipo_moneda" id="tipo_moneda" class="form-select" disabled><option value="">Seleccione...</option>{% for opt in opciones_tipo_moneda %}<option value="{{ opt }}" {% if opt == datos.tipo_moneda %}selected{% endif %}>{{ opt }}</option>{% endfor %}</select></div>
                                <div class="col-md-4 mb-3"><label for="prima_neta" class="form-label">Prima Neta</label><input type="text" name="prima_neta" id="prima_neta" class="form-control currency" value="{{ datos.prima_neta | default('', true) }}" readonly></div>
                                <div class="col-md-4 mb-3"><label for="gastos_adicionales" class="form-label">Gastos Adicionales</label><input type="text" name="gastos_adicionales" id="gastos_adicionales" class="form-control currency" value="{{ datos.gastos_adicionales | default('', true) }}" readonly></div>
                            </div>
                            <div class="row">
                                <div class="col-md-3 mb-3"><label for="porcentaje_comision_valor" class="form-label">% Comisión</label><input type="number" name="porcentaje_comision_valor" id="porcentaje_comision_valor" class="form-control" value="{{ datos.porcentaje_comision_valor | default('', true) }}" step="0.01" readonly></div>
                                <div class="col-md-3 mb-3"><label for="comision_calculada" class="form-label">Comisión $</label><input type="text" name="comision_calculada" id="comision_calculada" class="form-control currency" value="{{ datos['Comision$'] | default('', true) }}" readonly></div>
                                <div class="col-md-3 mb-3"><label for="vendedor" class="form-label">Vendedor</label><select name="vendedor" id="vendedor" class="form-select" disabled><option value="">Seleccione...</option>{% for vendedor in opciones_vendedor %}<option value="{{ vendedor.nombre }}" {% if vendedor.nombre == datos.vendedor %}selected{% endif %}>{{ vendedor.nombre }}</option>{% endfor %}</select></div>
                                <div class="col-md-3 mb-3"><label for="porcentaje_vendedor" class="form-label">% Part. Vendedor</label><input type="number" name="porcentaje_vendedor" id="porcentaje_vendedor" class="form-control" value="{{ datos.porcentaje_vendedor | default('', true) }}" step="0.01" readonly></div>
                            </div>
                            <div class="row">
                                <div class="col-md-4 mb-3"><label for="comision_tpp" class="form-label">Comisión TPP</label><input type="text" name="comision_tpp" id="comision_tpp" class="form-control currency" value="{{ datos.ComisionTPP | default('', true) }}" readonly></div>
                                <div class="col-md-4 mb-3"><label for="uib" class="form-label">Comisión UIB</label><input type="text" name="uib" id="uib" class="form-control currency" value="{{ datos.ComisionUIB | default('', true) }}" readonly></div>
                                <div class="col-md-4 mb-3"><label for="co_corretaje_opcion" class="form-label">Aplica Co-corretaje</label><select name="co_corretaje_opcion" id="co_corretaje_opcion" class="form-select" disabled><option value="no" {% if datos.co_corretaje_opcion != 'si' %}selected{% endif %}>No</option><option value="si" {% if datos.co_corretaje_opcion == 'si' %}selected{% endif %}>Sí</option></select></div>
                            </div>
                        </div>
                    </div>
                </div>
            </fieldset>

            <fieldset class="mb-4">
                <div class="card shadow-sm mb-4">
                    <div class="card-header"><h5 class="mb-0"><i class="fas fa-credit-card"></i> Información del Pago</h5></div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="row">
                                <div class="col-md-4 mb-3"><label for="periodicidad_pago" class="form-label">Periodicidad de Pago</label><select name="periodicidad_pago" id="periodicidad_pago" class="form-select" disabled><option value="">Seleccione...</option>{% for opt in opciones_periodicidad_pago %}<option value="{{ opt }}" {% if opt == datos.periodicidad_pago %}selected{% endif %}>{{ opt }}</option>{% endfor %}</select></div>
                                <div class="col-md-4 mb-3"><label for="forma_pago" class="form-label">Forma de Pago</label><select name="forma_pago" id="forma_pago" class="form-select" disabled><option value="">Seleccione...</option>{% for opt in opciones_forma_pago %}<option value="{{ opt }}" {% if opt == datos.forma_pago %}selected{% endif %}>{{ opt }}</option>{% endfor %}</select></div>
                                <div class="col-md-4 mb-3"><label for="numero_cuotas" class="form-label"># de Cuotas</label><input type="number" id="numero_cuotas" name="numero_cuotas" class="form-control" value="{{ datos.numero_cuotas | default('', true) }}" readonly></div>
                            </div>
                        </div>
                    </div>
                </div>
            </fieldset>

            <fieldset class="mb-4">
                <div class="card shadow-sm mb-4">
                    <div class="card-header"><h5 class="mb-0"><i class="far fa-file-alt"></i> Observaciones</h5></div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6 mb-3"><label for="observaciones" class="form-label">Observaciones</label><textarea name="observaciones" id="observaciones" class="form-control" rows="3" readonly>{{ datos.observaciones | default('', true) }}</textarea></div>
                            <div class="col-md-6 mb-3"><label for="riesgos_adicionales" class="form-label">Riesgos Adicionales</label><textarea name="riesgos_adicionales" id="riesgos_adicionales" class="form-control" rows="3" readonly>{{ datos.riesgos_adicionales | default('', true) }}</textarea></div>
                        </div>
                    </div>
                </div>
            </fieldset>
        
            <div class="text-end">
                <button type="submit" class="btn btn-primary" form="mainForm"><i class="fas fa-save"></i> Guardar Número de Remisión</button>
            </div>
        </form>
        <br>
        <footer class="pt-3 mt-4 text-muted border-top">&copy; 2024 UIB Corredores de Seguros S.A.</footer>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Función para formatear un valor numérico a moneda colombiana
    function formatCurrency(value) {
        if (isNaN(value) || value === null || value === '') {
            return '$ 0';
        }
        // Convierte el valor a número, asegurándose de que sea un float.
        const number = parseFloat(value);
        // Usa toLocaleString para formatear sin decimales.
        return '$' + Math.round(number).toLocaleString('es-CO');
    }

    // Aplica el formato a todos los campos de moneda al cargar la página
    document.querySelectorAll('.currency').forEach(input => {
        // Obtiene el valor, lo limpia de cualquier formato no numérico por si acaso
        let numericValue = input.value.replace(/[^0-9.,-]/g, '').replace(',', '.');
        input.value = formatCurrency(numericValue);
    });
});
</script>
</body>
</html>
